<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voucher & Promos PDP</title>
    <link rel="icon" type="image/x-icon" href="https://tinyurl.com/yt7f6mkc">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

</head>

<body>

    <main>
        <section id="voucher-payments-pdp">
            <div class="voucher-pdp_container">
            </div>

            <div class="voucher-pdp-modal-container"></div>
        </section>
    </main>
</body>

</html>


<script>
    let vouchers = [
        {
            id: "voucher1",
            icon: "images/voucher_icon.png",
            discount: "100% OFF.",
            minSpend: "min spend 15,000.",
            code: "Code Jhia",
            dateRange: "Sept 1 – Sept 30, 2025",
            modalTitle: "September Promo",
            modalSections: [
                {
                    title: "Terms & Conditions",
                    contentType: "list",
                    content: [
                        "Valid on min spend ₱10,000",
                        "One-time use per customer",
                        "Not convertible to cash"
                    ]
                }
            ]
        },
        {
            id: "voucher2",
            icon: "images/voucher_icon.png",
            discount: "15% OFF",
            minSpend: "min spend 10,000",
            code: "Code B",
            dateRange: "Sept 1 – Sept 30, 2025",
            modalTitle: "September Promo",
            modalSections: [
                {
                    contentType: "links",
                    title: "Where to avail",
                    content: [
                        { text: "abenson.com", href: "https://www.abenson.com" },
                        { text: "Abenson Viber Community", href: "#" },
                        { text: "Abenson Hotline: (02)8811-8811", href: "tel:0288118811" },
                    ],
                },
            ]
        },
        {
            id: "voucher3",
            icon: "images/voucher_icon.png",
            discount: "15% OFF",
            minSpend: "min spend 10,000",
            code: "Code C",
            dateRange: "Sept 1 – Sept 30, 2025",
            modalTitle: "September Promo",
            modalSections: [

                {
                    title: "Terms & Conditions",
                    contentType: "list",
                    content: [
                        "Valid on min spend ₱10,000",
                        "One-time use per customer",
                        "Not convertible to cash"
                    ]
                }
            ]
        },
        {
            id: "voucher5",
            icon: "images/voucher_icon.png",
            discount: "15% OFF",
            minSpend: "min spend 20,000",
            code: "Code D",
            dateRange: "Sept 1 – Sept 30, 2025",
            modalTitle: "September Promo",
            modalSections: [
                {
                    title: "Terms & Conditions",
                    contentType: "list",
                    content: [
                        "Valid on min spend ₱10,000",
                        "One-time use per customer",
                        "Not convertible to cash"
                    ]
                }
            ]
        }
    ];

    function renderVouchers() {
        const voucherContainer = document.querySelector(".voucher-pdp_container");
        const modalContainer = document.querySelector(".voucher-pdp-modal-container");

        voucherContainer.innerHTML = '';
        modalContainer.innerHTML = '';

        vouchers.forEach(voucher => {
            voucherContainer.innerHTML += createVoucherHTML(voucher);
            modalContainer.innerHTML += createModalHTML(voucher);
        });

        setupModalEvents(); // re-bind after rendering
    }

    function createVoucherHTML(voucher) {
        return `
        <div class="voucher-pdp_item">
            <button class="voucher-item" data-target="#modal-${voucher.id}">
                <img src="${voucher.icon || 'images/voucher_icon.png'}" alt="">
                <div class="voucher-pdp_info">
                    <strong class="voucher-info-title">${voucher.discount || ''}</strong>
                    <small class="voucher-info-subtitle">${voucher.minSpend || ''}</small>
                </div>
            </button>
            <button data-code="${voucher.code || ''}" class="copy-code_btn"  data-code="${voucher.code}">
                <span class="voucher-pdp_copybtn">Copy</span>
            </button>
        </div>
        `;
    }

    function createModalHTML(voucher) {
        const sectionsHTML = (Array.isArray(voucher.modalSections) ? voucher.modalSections : []).map(section => {
            const titleHTML = section.title ? `<strong class="section-description">${section.title}</strong>` : '';
            let contentHTML = '';

            if (section.contentType === "list") {
                contentHTML = `
                    <ul class="section-list">
                        ${section.content.map(item => `<li>${item}</li>`).join('')}
                    </ul>`;
            } else if (section.contentType === "links") {
                const isTwoColumn = section.content.length > 4;
                const linkClass = isTwoColumn ? "section-links two-columns" : "section-links";
                contentHTML = `
                    <ul class="${linkClass}">
                        ${section.content.map(link => `<li><a href="${link.href}" target="_blank">${link.text}</a></li>`).join('')}
                    </ul>`;
            } else if (section.contentType === "text") {
                contentHTML = `<p>${section.content}</p>`;
            }

            return `
            <div class="modal-infos">
                ${titleHTML}
                ${contentHTML}
            </div>`;
        }).join('');

        return `
        <dialog id="modal-${voucher.id}" class="modal hidden">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2 class="modal-title">${voucher.modalTitle || 'No Title'}</h2>
                ${voucher.dateRange?.trim() ? `<p class="modal-date">${voucher.dateRange}</p>` : ''}
                ${sectionsHTML}
                <div class="copy-code-modal">
                    <button class="copy-code_btn" data-code="${voucher.code}">Copy Code</button>
                </div>
            </div>
        </dialog>`;
    }

    document.addEventListener("click", function (e) {
        const btn = e.target.closest(".copy-code_btn");
        if (!btn) return;

        const code = btn.getAttribute("data-code");

        // Decide what text element to update
        const label = btn.querySelector(".voucher-pdp_copybtn") || btn;

        // Store the original text (so we know what to restore later)
        const originalText = label.textContent;

        navigator.clipboard.writeText(code)
            .then(() => {
                label.textContent = "Copied!";
                setTimeout(() => label.textContent = originalText, 2000);
            })
            .catch(() => {
                label.textContent = "Failed to copy";
                setTimeout(() => label.textContent = originalText, 2000);
            });
    });



    // Modal Setup Draggable
    // Modal Setup Draggable
    // Modal Setup Draggable
    function setupModalEvents() {
        const buttons = document.querySelectorAll('.voucher-item');

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const targetModal = document.querySelector(button.dataset.target);
                if (!targetModal) return;

                const content = targetModal.querySelector('.modal-content');

                // Reset styles only if hidden
                if (targetModal.classList.contains('hidden')) {
                    content.classList.remove('closing', 'slide-down');
                    content.style.transition = '';
                    content.style.transform = '';
                    content.style.opacity = '';
                }

                targetModal.classList.remove('hidden');
                content.classList.add('slide-in');
                document.body.style.overflow = 'hidden';

                content.addEventListener('animationend', () => {
                    content.classList.remove('slide-in');
                }, { once: true });
            });
        });

        document.querySelectorAll('.modal').forEach(modal => {
            const content = modal.querySelector('.modal-content');
            // let startY = 0;
            // let currentY = 0;
            // let isSwiping = false;
            let startY = 0;
            let currentY = 0;
            let lastMoveY = 0;
            let isSwiping = false;
            let swipeStartedFromTop = false;


            const closeModal = () => {
                const isMobile = window.matchMedia('(max-width: 767px)').matches;

                content.classList.add('closing');
                content.style.opacity = '0';

                if (isMobile) {
                    content.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
                    content.style.transform = 'translateY(100%)';
                }

                modal.classList.add('fading-out');

                const handleClose = () => {
                    modal.classList.add('hidden');
                    modal.classList.remove('fading-out');
                    content.classList.remove('closing');
                    content.style.transition = '';
                    content.style.transform = '';
                    content.style.opacity = '';
                    content.removeEventListener('animationend', handleClose);
                    content.removeEventListener('transitionend', handleClose);
                };

                content.addEventListener('animationend', handleClose, { once: true });
                content.addEventListener('transitionend', handleClose, { once: true });
            };

            content.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                lastMoveY = startY;
                isSwiping = true;
                swipeStartedFromTop = content.scrollTop === 0; // Only allow swipe-close if drag started at top
                content.style.transition = '';
            });

            content.addEventListener('touchmove', (e) => {
                if (!isSwiping || !swipeStartedFromTop) return;

                currentY = e.touches[0].clientY;
                const deltaY = currentY - startY;

                if (deltaY > 0) {
                    e.preventDefault(); // Block scroll
                    lastMoveY = currentY;

                    const resistance = Math.min(deltaY, 300);
                    content.style.transform = `translateY(${resistance}px)`;
                    // content.style.transform = `translateY(${resistance}px) scale(${Math.max(1 - resistance / 1000, 0.95)})`;
                    content.style.opacity = Math.max(1 - resistance / 300, 0.7);
                    document.body.style.overflow = 'hidden';
                }
            }, { passive: false });

            content.addEventListener('touchend', () => {
                const deltaY = currentY - startY;
                const endDirection = currentY - lastMoveY;

                isSwiping = false;
                document.body.style.overflow = '';

                if (swipeStartedFromTop && deltaY > 100 && endDirection >= 0) {
                    closeModal(); // Only close if started from top and still swiping down
                } else {
                    content.style.transition = 'transform 0.2s ease, opacity 0.2s ease';
                    content.style.transform = 'translateY(0) scale(1)';
                    content.style.opacity = '1';
                    content.addEventListener('transitionend', () => {
                        content.style.transition = '';
                    }, { once: true });
                }
            });


            modal.querySelector('.close-btn')?.addEventListener('click', closeModal);

            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        });
    }


    // Run once page is ready
    // document.addEventListener("DOMContentLoaded", renderVouchers);
    renderVouchers();
</script>

<style>
    * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        align-items: center;
        font-family: "Poppins", serif;
        color: #4c525c;
    }

    body,
    main {
        display: flex;
        flex-direction: column;
        position: relative;
    }

    main {
        width: 100%;
        display: flex;
        /* align-items: center; */
        max-width: 1400px;

    }

    h1 {
        color: #006de2;
        font-weight: 600;
        font-size: clamp(1.2rem, 2.8vw, 1.5rem);
        line-height: clamp(1.8rem, 4vw, 2.2rem);
    }



    #hero {
        width: 100%;
        position: relative;
        background-color: #ecf5ff;
        padding: clamp(3rem, 5vw, 5rem) clamp(1rem, 5vw, 5rem);
        max-width: 1400px;
        border-bottom-left-radius: 1.25rem;
        border-bottom-right-radius: 1.25rem;
    }


    a {
        text-decoration: none;
    }


    @media only screen and (width > 768px) {}

    @media only screen and (width > 968px) {}

    @media screen and (width > 1400px) {
        body {
            background-color: unset;
        }

        #hero {
            margin-top: 2rem;
            border-radius: 1.25rem;
        }
    }
</style>